<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="FMCG Distributor Control System - Owner Dashboard">
    <title>Owner Dashboard | FMCG Control</title>
    <link rel="stylesheet" href="css/style.css?v=3">
    <link rel="stylesheet" href="css/dark-mode.css?v=3">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* Premium Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
            animation: fadeInUp 0.5s var(--ease-out-expo) forwards;
        }

        .dashboard-title {
            margin: 0;
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
        }

        .dashboard-subtitle {
            color: var(--text-light);
            font-size: 15px;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid var(--border-color);
            cursor: pointer;
            padding: 12px;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-fast);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary-color);
            transform: rotate(90deg);
        }

        .refresh-btn.spinning {
            animation: spin 0.8s linear infinite;
        }

        /* Quick Actions - Premium Style */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-gradient);
            transform: scaleY(0);
            transition: transform var(--transition-fast);
        }

        .quick-action-btn:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            color: #4f46e5;
            /* Primary specific color to ensure contrast on light bg */
        }

        .quick-action-btn:active,
        .quick-action-btn:focus {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #4338ca;
            transform: translateY(-1px);
        }

        .quick-action-btn:hover::before {
            transform: scaleY(1);
        }

        .quick-action-btn span:first-child {
            font-size: 24px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-light);
            border-radius: var(--border-radius-md);
            transition: transform var(--transition-fast);
        }

        .quick-action-btn:hover span:first-child {
            transform: scale(1.1);
        }

        /* Premium Widget Enhancements */
        .dashboard-widgets .widget {
            position: relative;
            overflow: hidden;
        }

        .dashboard-widgets .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform var(--transition-normal);
        }

        .dashboard-widgets .widget:hover::before {
            transform: scaleX(1);
        }

        .dashboard-widgets .widget:nth-child(1) {
            animation: fadeInUp 0.4s ease forwards;
            animation-delay: 0.1s;
            opacity: 0;
        }

        .dashboard-widgets .widget:nth-child(2) {
            animation: fadeInUp 0.4s ease forwards;
            animation-delay: 0.2s;
            opacity: 0;
        }

        .dashboard-widgets .widget:nth-child(3) {
            animation: fadeInUp 0.4s ease forwards;
            animation-delay: 0.3s;
            opacity: 0;
        }

        .dashboard-widgets .widget:nth-child(4) {
            animation: fadeInUp 0.4s ease forwards;
            animation-delay: 0.4s;
            opacity: 0;
        }

        .dashboard-widgets .widget:nth-child(5) {
            animation: fadeInUp 0.4s ease forwards;
            animation-delay: 0.5s;
            opacity: 0;
        }

        .widget-value {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }

        .widget-value span:first-child {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-color);
            letter-spacing: -0.03em;
        }

        .widget-change {
            font-size: 12px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: var(--border-radius-full);
        }

        .widget-change.positive {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #059669;
        }

        .widget-change.negative {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }

        /* Alerts Section */
        .alerts-section {
            margin-bottom: 40px;
        }

        .alerts-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 700;
        }

        .alerts-section h2::before {
            content: 'üîî';
            font-size: 24px;
        }

        /* Charts Section */
        .charts-section {
            margin-top: 40px;
        }

        .charts-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 28px;
            font-size: 20px;
            font-weight: 700;
        }

        .charts-section h2::before {
            content: 'üìà';
            font-size: 24px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
        }

        .chart-card {
            background: var(--card-bg);
            padding: 28px;
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 0, 0, 0.04);
            transition: all var(--transition-normal);
        }

        .chart-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .chart-card h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            height: 280px;
            position: relative;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 16px;
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-title {
                font-size: 28px;
            }
        }

        @media (max-width: 480px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <button class="mobile-menu-btn" aria-label="Toggle menu">‚ò∞</button>
        <div class="nav-brand">üìä FMCG Control</div>

        <div class="nav-links" id="navLinks">
            <a href="dashboard.html" class="nav-link active">Dashboard</a>
            <a href="purchase-orders.html" class="nav-link">Purchase Orders</a>
            <a href="returns.html" class="nav-link">Returns</a>
            <a href="reports.html" class="nav-link">Reports</a>
            <a href="sales-targets.html" class="nav-link">Targets</a>
            <a href="retailers.html" class="nav-link">Retailers</a>
            <a href="brands-skus.html" class="nav-link">Brands & SKUs</a>
            <a href="dispatch.html" class="nav-link">Dispatch</a>
            <a href="credit-control.html" class="nav-link">Credit Control</a>

            <!-- Notification Center -->
            <div class="notification-wrapper">
                <button class="notification-bell" id="notificationBell" onclick="toggleNotifications()">
                    üîî
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <span>Notifications</span>
                        <span style="font-size: 12px; color: var(--text-light); cursor: pointer;"
                            onclick="markAllRead()">Mark all read</span>
                    </div>
                    <div class="notification-list" id="notificationList">
                        <div class="notification-empty">No new notifications</div>
                    </div>
                </div>
            </div>

            <span class="nav-user" id="navUser"></span>
            <button class="btn btn-sm btn-secondary" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="container">
        <!-- ... (header & widgets unchanged) ... -->
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title" id="dashboardTitle">Owner Dashboard</h1>
                <div class="dashboard-subtitle">
                    <span class="status-dot"></span>
                    <span id="lastUpdated">Last updated: --</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="refresh-btn" onclick="refreshDashboard()" title="Refresh data">
                    üîÑ
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="purchase-orders.html" class="quick-action-btn glass-panel">
                <span>üì¶</span>
                <span>Purchase Orders</span>
            </a>
            <a href="returns.html" class="quick-action-btn glass-panel">
                <span>‚Ü©Ô∏è</span>
                <span>Returns</span>
            </a>
            <a href="reports.html" class="quick-action-btn glass-panel">
                <span>üìä</span>
                <span>Reports Center</span>
            </a>
            <a href="dispatch.html" class="quick-action-btn glass-panel">
                <span>üöö</span>
                <span>New Dispatch</span>
            </a>
        </div>

        <div class="dashboard-widgets">
            <div class="widget glass-panel">
                <div class="widget-icon blue">üí∞</div>
                <div class="widget-header">Today Gross Profit</div>
                <div class="widget-value">
                    <span id="todayProfit" class="skeleton skeleton-text">‚Çπ0</span>
                    <span class="widget-change positive" id="todayProfitChange">--</span>
                </div>
            </div>

            <div class="widget glass-panel">
                <div class="widget-icon green">üìà</div>
                <div class="widget-header">Monthly Gross Profit</div>
                <div class="widget-value">
                    <span id="monthlyProfit" class="skeleton skeleton-text">‚Çπ0</span>
                    <span class="widget-change" id="monthlyProfitChange">--</span>
                </div>
            </div>

            <div class="widget glass-panel">
                <div class="widget-icon yellow">‚ö†Ô∏è</div>
                <div class="widget-header">Outstanding Credit</div>
                <div class="widget-value">
                    <span id="outstandingCredit" class="skeleton skeleton-text">‚Çπ0</span>
                </div>
            </div>

            <div class="widget glass-panel">
                <div class="widget-icon red">üì¶</div>
                <div class="widget-header">Capital Locked in Stock</div>
                <div class="widget-value">
                    <span id="capitalLocked" class="skeleton skeleton-text">‚Çπ0</span>
                </div>
            </div>

            <div class="widget glass-panel">
                <div class="widget-icon blue">ü•õ</div>
                <div class="widget-header">Amul Capital %</div>
                <div class="widget-value">
                    <span id="amulCapitalPercent" class="skeleton skeleton-text">0%</span>
                </div>
            </div>
        </div>

        <!-- Alerts Section REMOVED -->

        <!-- Charts Section -->
        <div class="charts-section">
            <h2>Analytics Overview</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìâ Sales Trend (Last 30 Days)</h3>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üè∑Ô∏è Brand Performance</h3>
                    <div class="chart-container">
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üì¶ Inventory Status</h3>
                    <div class="chart-container">
                        <canvas id="inventoryChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Sales Target Progress</h3>
                    <div class="chart-container">
                        <canvas id="targetChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/notifications.js?v=2"></script>
    <script src="js/security-utils.js?v=3"></script>
    <script src="js/ui-utils.js?v=3"></script>
    <script src="js/auth.js?v=3"></script>
    <script src="js/charts.js?v=3"></script>
    <script src="js/dashboard.js?v=4"></script>
    <script>


        async function refreshDashboard() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('spinning');

            try {
                if (typeof loadDashboardData === 'function') {
                    await loadDashboardData();
                }
                if (typeof initDashboardCharts === 'function') {
                    await initDashboardCharts();
                }

                document.getElementById('lastUpdated').textContent =
                    'Last updated: ' + new Date().toLocaleTimeString('en-IN');

                Toast.success('Dashboard refreshed');
            } catch (error) {
                Toast.error('Failed to refresh dashboard');
            } finally {
                btn.classList.remove('spinning');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('lastUpdated').textContent =
                'Last updated: ' + new Date().toLocaleTimeString('en-IN');

            if (typeof initDashboardCharts === 'function') {
                setTimeout(initDashboardCharts, 500);
            }
        });
    </script>
</body>

</html>